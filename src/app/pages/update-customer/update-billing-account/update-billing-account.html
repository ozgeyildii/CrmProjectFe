<div class="card border-warning p-3 customer-account-section">
  <div class="header-bar">
    <h4 class="fw-semibold text-orange mb-0">Customer Accounts</h4>
    <button class="btn btn-orange" (click)="createAccount()">+ Add Customer Account</button>
  </div>

  <div
    class="d-none d-md-flex fw-semibold text-secondary bg-light rounded px-3 py-2 border border-warning mb-2"
  >
    <div class="col text-center col-md-2">Account Status</div>
    <div class="col text-center col-md-3">Account Number</div>
    <div class="col text-center col-md-3">Account Name</div>
    <div class="col text-center col-md-2">Account Type</div>
    <div class="col text-end col-md-2">Action</div>
  </div>

  <div class="accordion" id="accountsAccordion">
    <div class="accordion-item mb-2" *ngFor="let acc of accounts(); let i = index">
      <h2 class="accordion-header">
        <button
          class="accordion-button collapsed bg-white"
          type="button"
          data-bs-toggle="collapse"
          [attr.data-bs-target]="'#collapse' + i"
          aria-expanded="false"
          [attr.aria-controls]="'collapse' + i"
        >
          <div class="row w-100 align-items-center text-center">
            <div class="col-6 col-md-2 fw-semibold text-success">{{ acc.status }}</div>
            <div class="col-6 col-md-3">{{ acc.accountNumber }}</div>
            <div class="col-12 col-md-3 text-truncate">{{ acc.accountName }}</div>
            <div class="col-6 col-md-2">{{ acc.type }}</div>

            <div class="col-6 col-md-2 text-end action-icons">
              <i class="bi bi-trash me-2 text-danger" (click)="deleteAccount(acc.id)"></i>
              <i class="bi bi-pencil text-orange"></i>
            </div>
          </div>
        </button>
      </h2>

      <div
        [id]="'collapse' + i"
        class="accordion-collapse collapse"
        [attr.data-bs-parent]="'#accountsAccordion'"
      >
        <div class="accordion-body bg-white border-top border-warning rounded-bottom">
          <div class="table-responsive">
            <table class="table table-bordered table-sm align-middle product-table">
              <thead class="table-light">
                <tr class="text-center">
                  <th>Product ID</th>
                  <th>Product Name</th>
                  <th>Campaign ID</th>
                  <th>Campaign Name</th>
                  <th>Action</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let item of productDetails()[acc.id] || []" class="text-center">
                  <td>{{ item.productId }}</td>
                  <td class="text-wrap">{{ item.productName }}</td>
                  <td>{{ item.campaignId ?? '-' }}</td>
                  <td class="text-wrap">{{ item.campaignName ?? '-' }}</td>
                  <td>
                    <i
                      class="bi bi-eye text-orange cursor-pointer"
                      (click)="openDetailsModal(item)"
                    ></i>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="d-flex flex-wrap gap-2 justify-content-end mt-3">
            <button class="btn btn-outline-warning btn-sm" (click)="goToOfferSelection(acc.id)">
              Start New Sale
            </button>
            <button class="btn btn-outline-warning btn-sm">Transfer</button>
            <button class="btn btn-outline-warning btn-sm">Service Address Change</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="pagination-bar mt-3">
    <button class="btn btn-outline-secondary btn-sm" (click)="prevPage()">&lt;</button>
    <span class="fw-medium">{{ currentPage() + 1 }} / {{ totalPages() }}</span>
    <button class="btn btn-outline-secondary btn-sm" (click)="nextPage()">&gt;</button>
  </div>
</div>
<!-- PRODUCT MODAL -->
<dialog id="productModal" class="product-modal">
  <div class="modal-content-custom">
    <div class="modal-header-custom">
      <h5 class="fw-semibold text-orange mb-0">Product Details</h5>
      <i class="bi bi-x-lg close-icon" (click)="closeModal()"></i>
    </div>

    <div class="modal-body-custom">
      <div class="row mb-3">
        <div class="col">
          <label class="text-muted small">Product ID</label>
          <div class="detail-box">{{ selectedProduct()?.productId }}</div>
        </div>

        <div class="col">
          <label class="text-muted small">Product Name</label>
          <div class="detail-box">{{ selectedProduct()?.productName }}</div>
        </div>
      </div>

      <hr />

      <div class="mb-3">
        <label class="fw-semibold small">Campaign</label>
        <div class="detail-box mt-2">
          {{ selectedProduct()?.campaignName ?? 'No Campaign' }}
          <div *ngIf="selectedProduct()?.campaignId" class="text-muted small">
            ID: {{ selectedProduct()?.campaignId }}
          </div>
        </div>
      </div>

      <hr />

      <div>
        <label class="fw-semibold small">Address</label>
        <div class="detail-box mt-2">
          {{ selectedProduct()?.addressText }}
        </div>
      </div>
    </div>

    <div class="modal-footer-custom">
      <button class="btn btn-outline-orange px-5 py-1" (click)="closeModal()">OKAY</button>
    </div>
  </div>
</dialog>

<div class="card shadow-sm border-warning p-4" [formGroup]="accountForm">
  <h5 class="text-orange fw-semibold mb-4">Create Billing Account</h5>

  <div class="row g-4">
    <!-- SOL TARAF -->
    <div class="col-md-6">
      <label class="form-label fw-medium">Account Name *</label>
      <input
        type="text"
        class="form-control"
        formControlName="accountName"
        placeholder="Enter account name"
      />
      <div
        *ngIf="accountForm.get('accountName')?.touched && accountForm.get('accountName')?.invalid"
        class="text-danger small mt-1"
      >
        Name is required (min 2 chars)
      </div>
    </div>

    <!-- SAÄž TARAF -->
    <div class="col-md-6">
      <h6 class="text-orange fw-semibold">Address Info</h6>

      <div *ngIf="tempAddress(); else noAddress" class="border rounded p-3 mt-2 bg-light">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <p class="mb-1">
              <strong>{{ tempAddress()?.street }}</strong> No:
              {{ tempAddress()?.houseNumber }}
            </p>
            <p class="text-muted mb-0">{{ tempAddress()?.description }}</p>
          </div>
          <button class="btn btn-outline-danger btn-sm" type="button" (click)="deleteAddress()">
            ðŸ—‘ Delete
          </button>
        </div>
      </div>

      <ng-template #noAddress>
        <p class="text-muted mt-2">No address added yet.</p>
      </ng-template>

      <button
        class="btn btn-outline-warning mt-3"
        type="button"
        (click)="openModalForNew()"
        [disabled]="tempAddress() !== null"
      >
        + Add New Address
      </button>
    </div>
  </div>

  <div class="d-flex justify-content-end mt-4 gap-2">
    <button class="btn btn-secondary" type="button" (click)="onCancel()">Cancel</button>
    <button class="btn btn-warning text-white" type="button" (click)="onSubmit()">Create</button>
  </div>

  <!-- MODAL -->
  <div class="modal fade show d-block" *ngIf="showModal()" tabindex="-1" style="background: rgba(0, 0, 0, 0.45);">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-warning" [formGroup]="addressForm">
        <div class="modal-header">
          <h6 class="modal-title text-orange">Add Address</h6>
          <button type="button" class="btn-close" (click)="showModal.set(false)"></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">City *</label>
              <select class="form-select" formControlName="cityId" (change)="onCityChange()">
                <option value="">Select</option>
                <option *ngFor="let city of cities()" [value]="city.id">{{ city.name }}</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">District *</label>
              <select class="form-select" formControlName="districtId">
                <option value="">Select</option>
                <option *ngFor="let dist of districts()" [value]="dist.id">{{ dist.name }}</option>
              </select>
            </div>
          </div>

          <div class="row g-3 mt-2">
            <div class="col-md-6">
              <label class="form-label">Street *</label>
              <input class="form-control" formControlName="street" placeholder="Enter street" />
            </div>
            <div class="col-md-6">
              <label class="form-label">House Number *</label>
              <input class="form-control" formControlName="houseNumber" placeholder="Enter house no" />
            </div>
          </div>

          <label class="form-label mt-3">Description *</label>
          <textarea class="form-control" formControlName="description" rows="3" placeholder="Enter address description"></textarea>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="showModal.set(false)">Cancel</button>
          <button
            type="button"
            class="btn btn-warning text-white"
            (click)="saveAddress()"
            [disabled]="isLoading()"
          >
            {{ isLoading() ? 'Saving...' : 'Save' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

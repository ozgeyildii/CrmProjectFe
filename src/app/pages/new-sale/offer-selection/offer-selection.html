<div class="container-fluid py-3">
  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-header bg-light text-orange fw-semibold fs-5">Offer Selection</div>
    <div class="card-body bg-light-subtle">
      <div class="row g-3">
        <!-- SOL: Catalog/Campaign -->
        <div class="col-lg-7">
          <div class="bg-white p-3 rounded-4 shadow-sm">
            <div class="d-flex mb-3">
              <button
                class="btn flex-fill"
                [class.btn-orange]="activeTab() === 'catalog'"
                [class.btn-outline-orange]="activeTab() !== 'catalog'"
                (click)="setTab('catalog')"
              >
                Catalog
              </button>
              <button
                class="btn flex-fill"
                [class.btn-orange]="activeTab() === 'campaign'"
                [class.btn-outline-orange]="activeTab() !== 'campaign'"
                (click)="setTab('campaign')"
              >
                Campaign
              </button>
            </div>

            <!-- Catalog -->
            <div *ngIf="activeTab() === 'catalog'">
              <label class="fw-semibold mb-2">Catalog Selection</label>
              <select
                class="form-select mb-3"
                [(ngModel)]="selectedCatalogId"
                (change)="onCatalogSelect()"
              >
                <option [ngValue]="null">Select</option>
                <option *ngFor="let c of catalogs()" [ngValue]="c.id">{{ c.name }}</option>
              </select>

              <table class="table table-sm table-hover align-middle text-center">
                <thead class="table-light">
                  <tr>
                    <th>ID</th>
                    <th>Offer Name</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let o of catalogOffers()"
                    (click)="selectOffer(o, 'OFFER')"
                    [class.table-active]="
                      selectedOffer()?.id === o.id && selectedOffer()?.type === 'OFFER'
                    "
                  >
                    <td>{{ o.id }}</td>
                    <td>{{ o.name }}</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Campaign -->
            <div *ngIf="activeTab() === 'campaign'">
              <label class="fw-semibold mb-2">Campaign Selection</label>
              <select
                class="form-select mb-3"
                [(ngModel)]="selectedCampaignId"
                (change)="onCampaignSelect()"
              >
                <option [ngValue]="null">Select</option>
                <option *ngFor="let c of campaigns()" [ngValue]="c.id">{{ c.name }}</option>
              </select>

              <!-- ðŸ”¹ Filtre inputlarÄ± -->
              <div class="input-group mb-3">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Campaign ID"
                  [ngModel]="campaignIdFilter()"
                  (ngModelChange)="campaignIdFilter.set($event)"
                />
                <input
                  type="text"
                  class="form-control"
                  placeholder="Offer Name"
                  [ngModel]="campaignNameFilter()"
                  (ngModelChange)="campaignNameFilter.set($event)"
                />
              </div>

              <!-- ðŸ”¹ FiltrelenmiÅŸ tablo -->
              <table class="table table-sm table-hover align-middle text-center">
                <thead class="table-light">
                  <tr>
                    <th>Campaign ID</th>
                    <th>Product Offer ID</th>
                    <th>Offer Name</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let o of filteredCampaignOffers()"
                    (click)="selectOffer(o, 'CAMPAIGN')"
                    [class.table-active]="
                      selectedOffer()?.id === o.id &&
                      selectedOffer()?.type === 'CAMPAIGN'
                    "
                  >
                    <td>{{ o.campaignId }}</td>
                    <td>{{ o.productOfferId }}</td>
                    <td>{{ o.productOfferName }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ORTA: Add to Basket -->
        <div class="col-lg-1 d-flex justify-content-center align-items-center">
          <button
            class="btn btn-lg btn-outline-orange rounded-circle shadow-sm"
            [disabled]="!selectedOffer() || loading()"
            (click)="addToBasket()"
          >
            <span *ngIf="!loading()">âžœ</span>
            <div *ngIf="loading()" class="spinner-border spinner-border-sm text-orange"></div>
          </button>
        </div>

        <!-- SAÄž: Basket -->
        <div class="col-lg-4">
          <div class="bg-white rounded-4 p-3 shadow-sm">
            <h5 class="text-orange fw-semibold mb-3">Basket</h5>
            <div class="small" *ngIf="basket().basketItems.length === 0">No items in basket.</div>

            <div
              *ngFor="let b of basket().basketItems"
              class="d-flex justify-content-between border-bottom py-2"
            >
              <div>
                <div class="fw-bold">{{ b.productOfferName }}</div>
                <div class="text-muted small">{{ b.productOfferId }}</div>
              </div>
              <div class="fw-semibold">
                {{ b.discountedPrice || b.price | number : '1.2-2' }} TL
              </div>
            </div>

            <div class="d-flex justify-content-between mt-3 fw-bold border-top pt-2">
              <span>Total Amount</span>
              <span>{{ total | number : '1.2-2' }} TL</span>
            </div>

            <div class="mt-3 d-flex justify-content-between">
              <button class="btn btn-outline-orange btn-sm" (click)="clearBasket()" [disabled]="basket().basketItems.length === 0">Clear</button>
              <button class="btn btn-orange btn-sm" [disabled]="basket().basketItems.length === 0" (click)="goNext()">Next</button>
            </div>

            <div *ngIf="errorMsg()" class="text-danger small mt-2 text-center">
              {{ errorMsg() }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
